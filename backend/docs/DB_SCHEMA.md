# Symmetry Database Schema & Sync Strategy

This document defines the NoSQL data schema for Firebase Firestore and the "Offline-First" synchronization strategy for the *My Reports* feature.

## 1. Core Collections

### `users` (Collection)
Stores profile information for users (journalists/visitors).
* **Doc ID:** `AuthUID` (provided by Firebase Auth).
* **Fields:**
    * `email` (string): User email address.
    * `displayName` (string): User's full name.
    * `photoURL` (string): Profile picture URL (Default placeholder used initially).
    * `createdAt` (timestamp): Registration date.
* **Sub-Collections:**
    * `saved_articles`: Doc ID = Article URL. Contains references to bookmarked articles.
    * `liked_articles`: Doc ID = Article URL. Contains references to liked articles.

### `articles` (Collection)
Stores fitness reports created by users. This collection acts as the Global Feed.
* **Doc ID:** Automatically generated by Firestore (Auto-ID) upon synchronization.
* **Fields:**
    * `userId` (string): Reference to the author (`users/{uid}`).
    * `author` (string): Author's name (denormalized for read efficiency).
    * `authorPhoto` (string): Author's photo URL (denormalized to avoid extra reads).
    * `title` (string): The headline of the fitness news.
    * `content` (string): The body of the article.
    * `category` (string): E.g., "Nutrition", "Workout", "Mental Health".
    * `tags` (array<string>): E.g., ["cardio", "protein", "yoga"].
    * `urlToImage` (string): Public URL of the cover image in Firebase Storage.
        * *Storage Path:* `media/articles/{userId}/{timestamp}.jpg`
    * `publishedAt` (string ISO-8601): Creation date (used for sorting feed).
    * `likesCount` (int): Global popularity counter.
    * `syncedAt` (timestamp): Server upload timestamp.

## 2. Synchronization Strategy (Offline-First)

To strictly comply with the "Offline-First" requirement, the app never writes directly to Firestore when saving an article. It follows this flow:

1.  **Local Write (Floor DB):**
    * The article is saved to the local SQLite database (`article_table`).
    * Assigned status: `syncStatus = 'pending'`.
    * The image is saved to a temporary local path on the device.

2.  **Background Sync (Worker/Repository):**
    * When connectivity is detected, the `SyncWorker` queries articles where `syncStatus == 'pending'`.
    * **Step A (Media):** Uploads the local image to Firebase Storage (`media/articles/`). Retrieves the `downloadURL`.
    * **Step B (Data):** Uploads the article object to the Firestore `articles` collection using the new `downloadURL`.
    * **Step C (Confirm):** Updates the local record to `syncStatus = 'synced'` and stores the remote Firestore ID for future reference.

## 3. Storage Rules Reference
Images must be strictly hosted in the `media/articles` folder to enforce security rules and file organization.